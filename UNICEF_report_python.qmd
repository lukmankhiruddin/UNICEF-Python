---
title: "GROWING HOPE"
subtitle: "**Understanding Child Growth & HIV Awareness Worldwide**"
format:
  html:
    toc: true
    theme: sandstone
    code-fold: true         # Make code foldable
    code-tools: true        # Add code tools (copy, etc.)
    code-summary: "Show code" # Text shown on the code folding button
    embed-resources: true   # Embed all resources in the HTML file
execute:
  echo: true                # Show code by default (changed from false)
  warning: false
  message: false
  error: false
jupyter: python3
author: "Lukman Khiruddin"
date: "April 22 2025"
---

------------------------------------------------------------------------


                                                                                                                                                           
## [Introduction]{style="font-family: serif"}

In every corner of our world, the journey of childhood unfolds with both promise and pitfalls. Where the glow of hope is often shadowed by the realities of stunted growth and the silent spread of HIV.

This dashboard invites you to explore the global landscape of child development, weaving together vivid data on child stunting and HIV awareness to reveal the stark contrasts and hidden connections shaping young lives.


```{python}
#| code-fold: true
#| code-summary: "Show code"

# Import necessary libraries
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import re
import geopandas as gpd
from matplotlib.colors import LinearSegmentedColormap
import matplotlib.patches as mpatches
from matplotlib import rcParams

# Define R-like color palette to match ggplot2 aesthetics
R_COLORS = {
    'green': '#00BA38',     # Green from R's default palette
    'red': '#F8766D',       # Red from R's default palette
    'blue': '#619CFF',      # Blue from R's default palette
    'orange': '#FF9E4A',    # Orange from R's default palette
    'yellow': '#B79F00',    # Yellow from R's default palette
    'background': '#F0F0F0', # Light gray background like ggplot2
    'grid': '#CCCCCC',      # Light grid lines
    'text': '#000000'       # Black text
}

# Configure matplotlib to look like R's ggplot2
rcParams['font.family'] = 'sans-serif'
rcParams['font.sans-serif'] = ['Arial', 'DejaVu Sans']
rcParams['font.size'] = 10
rcParams['axes.titlesize'] = 14
rcParams['axes.titleweight'] = 'bold'
rcParams['axes.labelsize'] = 11
rcParams['xtick.labelsize'] = 9
rcParams['ytick.labelsize'] = 9
rcParams['legend.fontsize'] = 9
rcParams['figure.titlesize'] = 16
rcParams['figure.titleweight'] = 'bold'

# Set figure DPI to match R's output
plt.rcParams['figure.dpi'] = 120
plt.rcParams['savefig.dpi'] = 120

# Use seaborn whitegrid style as base and customize it
plt.style.use('seaborn-v0_8-whitegrid')

# Set default figure size
plt.rcParams['figure.figsize'] = (10, 6)

# Remove top and right spines to match ggplot2
plt.rcParams['axes.spines.top'] = False
plt.rcParams['axes.spines.right'] = False
```

```{python}
#| include: false

# Data Exploration
unicef_indicator_1 = pd.read_csv("unicef_indicator_1.csv")
unicef_indicator_2 = pd.read_csv("unicef_indicator_2.csv")
unicef_metadata = pd.read_csv("unicef_metadata.csv")
combined_indicators = pd.read_csv("Indicator_Combined.csv")
```

```{python}
#| include: false

# Check the structure of datasets
unicef_indicator_1.head()
unicef_indicator_2.head()
unicef_metadata.head()
```

```{python}
#| include: false

# Checking the shape and missing values in unicef_indicator_1 dataset
print(unicef_indicator_1.shape)
missing_values_1 = unicef_indicator_1.isna().sum()
print(missing_values_1)
# In the unicef_indicator_1 dataset, four columns contain only missing values - removing them
```

```{python}
#| include: false

# Fill missing values of alpha_2_code with alpha_3_code
unicef_indicator_1['alpha_2_code'] = unicef_indicator_1['alpha_2_code'].fillna(unicef_indicator_1['alpha_3_code'])

# Drop columns with all missing values from unicef_indicator_1 dataset
cols_to_drop = ["time_period_activity_related_to_when_the_data_are_collected", 
                "observation_confidentaility", 
                "observation_status", 
                "unit_multiplier"]
unicef_indicator_1 = unicef_indicator_1.drop(columns=cols_to_drop, errors='ignore')
```

```{python}
#| include: false

# Missing values in unicef_indicator_2 dataset
missing_values_2 = unicef_indicator_2.isna().sum()
print(missing_values_2)

# Fill missing values of alpha_2_code with alpha_3_code
unicef_indicator_2['alpha_2_code'] = unicef_indicator_2['alpha_2_code'].fillna(unicef_indicator_2['alpha_3_code'])
```

```{python}
#| include: false

# Missing values in unicef_metadata dataset
missing_values_metadata = unicef_metadata.isna().sum()
print(missing_values_metadata)

# Drop rows with missing values from unicef_metadata dataset
unicef_metadata = unicef_metadata.dropna()
```

## [HIV Knowledge Among Youth by Country]{style="font-family: serif"}

This comparison highlights the percentage of young people (aged 15–24) who possess comprehensive, correct knowledge of HIV across countries. By displaying both the leaders and laggards, we can better understand the global disparities in HIV education. This helps policymakers identify both success stories to emulate and areas where urgent action is needed.

::: {.panel-tabset}

## Top 5 Countries

```{python hiv_knowledge_top_tab}
#| code-fold: true
#| code-summary: "Show code for top countries chart"
#| fig-align: center
#| fig-width: 8
#| fig-height: 5
#| out-width: 100%

# Filter HIV knowledge data
hiv_knowledge_data = combined_indicators[
    combined_indicators['indicator'].str.contains('comprehensive, correct knowledge of HIV', case=False, na=False)
]
hiv_knowledge_data = hiv_knowledge_data[~hiv_knowledge_data['obs_value'].isna()]

# Get the most recent data for each country and sex
recent_hiv_knowledge = hiv_knowledge_data.sort_values('time_period', ascending=False).groupby(['country', 'sex']).first().reset_index()

# Calculate average knowledge by country and sort
avg_knowledge = recent_hiv_knowledge.groupby('country')['obs_value'].mean().reset_index()
avg_knowledge = avg_knowledge.sort_values('obs_value', ascending=False)

# Get top 5 countries
top_5_countries = avg_knowledge.head(5)

# Create figure
fig, ax = plt.subplots(figsize=(8, 5))

# Create bars with R's green color
bars = ax.barh(np.arange(len(top_5_countries)), 
       top_5_countries['obs_value'], 
       color=R_COLORS['green'],
       height=0.6)

# Set background light gray like ggplot2
ax.set_facecolor(R_COLORS['background'])
fig.patch.set_facecolor('white')

# Add percentage labels
for i, bar in enumerate(bars):
    ax.text(bar.get_width() + 1, 
            bar.get_y() + bar.get_height()/2, 
            f"{top_5_countries['obs_value'].iloc[i]:.1f}%", 
            va='center',
            fontsize=10)

# Set country names as y-tick labels
ax.set_yticks(np.arange(len(top_5_countries)))
ax.set_yticklabels(top_5_countries['country'].tolist(), 
                  fontsize=11)

# Set x-axis limits and ticks
ax.set_xlim(0, 75)
ax.set_xticks(np.arange(0, 71, 10))

# Add title and labels
ax.set_title('Top 5 Countries with Highest HIV Knowledge', 
            fontsize=14, 
            fontweight='bold', 
            pad=15)
ax.annotate('Youth (15-24 years)', 
           xy=(0.5, 1.05), 
           xycoords='axes fraction', 
           ha='center', 
           va='center', 
           fontsize=10)
ax.set_xlabel('Percentage (%)', 
             fontsize=10)
ax.set_ylabel('')

# Configure grid to match ggplot2
ax.grid(axis='x', linestyle='-', linewidth=0.5, color=R_COLORS['grid'], alpha=0.7)
ax.grid(axis='y', visible=False)

# Remove unnecessary spines
ax.spines['left'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.spines['top'].set_visible(False)

plt.tight_layout()
plt.show()
```

## Bottom 5 Countries

```{python hiv_knowledge_bottom_tab}
#| code-fold: true
#| code-summary: "Show code for bottom countries chart"
#| fig-align: center
#| fig-width: 8
#| fig-height: 5
#| out-width: 100%

# Get bottom 5 countries
bottom_5_countries = avg_knowledge.tail(5)

# Create figure
fig, ax = plt.subplots(figsize=(8, 5))

# Create bars with R's green color to match
bars = ax.barh(np.arange(len(bottom_5_countries)), 
       bottom_5_countries['obs_value'], 
       color=R_COLORS['green'],
       height=0.6)

# Set background light gray like ggplot2
ax.set_facecolor(R_COLORS['background'])
fig.patch.set_facecolor('white')

# Add percentage labels
for i, bar in enumerate(bars):
    ax.text(bar.get_width() + 1, 
            bar.get_y() + bar.get_height()/2, 
            f"{bottom_5_countries['obs_value'].iloc[i]:.1f}%", 
            va='center',
            fontsize=10)

# Set country names as y-tick labels
ax.set_yticks(np.arange(len(bottom_5_countries)))
ax.set_yticklabels(bottom_5_countries['country'].tolist(), 
                  fontsize=11)

# Set x-axis limits and ticks
ax.set_xlim(0, 75)
ax.set_xticks(np.arange(0, 71, 10))

# Add title and labels
ax.set_title('Bottom 5 Countries with Lowest HIV Knowledge', 
            fontsize=14, 
            fontweight='bold', 
            pad=15)
ax.annotate('Youth (15-24 years)', 
           xy=(0.5, 1.05), 
           xycoords='axes fraction', 
           ha='center', 
           va='center', 
           fontsize=10)
ax.set_xlabel('Percentage (%)', 
             fontsize=10)
ax.set_ylabel('')

# Configure grid to match ggplot2
ax.grid(axis='x', linestyle='-', linewidth=0.5, color=R_COLORS['grid'], alpha=0.7)
ax.grid(axis='y', visible=False)

# Remove unnecessary spines
ax.spines['left'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.spines['top'].set_visible(False)

plt.tight_layout()
plt.show()
```

:::

This tabbed comparison reveals stark disparities in HIV knowledge among youth globally. The top-performing countries (primarily in Eastern and Southern Africa) have achieved knowledge rates above 50%, while the lowest-performing countries show rates below 5%. 

This significant gap (over 55 percentage points between highest and lowest) highlights implementation disparities in HIV education programs worldwide. Countries at the bottom of the ranking could benefit from adapting successful education strategies from top-performing nations.

## [Top 4 Countries with HIV Knowledge Trends Over Time]{style="font-family: serif"}

This line chart tracks the evolution of HIV knowledge among males and females in 4 countries over time. The visual uncovers whether both genders are benefiting equally from education efforts, and whether progress is steady, stagnant, or declining. It provides a clear picture of gender gaps and helps guide future interventions to ensure no one is left behind.

```{python hiv_knowledge_trends}
#| code-fold: true
#| code-summary: "Show code for trends chart"
#| fig-align: center
#| fig-width: 10
#| fig-height: 6
#| out-width: 90%

# Filter data for comprehensive HIV knowledge
hiv_knowledge_data = combined_indicators[
    combined_indicators['indicator'].str.contains('comprehensive, correct knowledge of HIV', case=False, na=False)
]
hiv_knowledge_data = hiv_knowledge_data[~hiv_knowledge_data['obs_value'].isna()]
hiv_knowledge_data = hiv_knowledge_data[hiv_knowledge_data['sex'].isin(['Female', 'Male'])]

# Count data points by country and sex to find those with the most data
country_data_counts = (
    hiv_knowledge_data.groupby(['country', 'sex'])
    .size()
    .reset_index(name='data_points')
    .groupby('country')
    .agg(
        total_points=('data_points', 'sum'),
        has_both_sexes=('sex', 'nunique')
    )
    .reset_index()
)

# Filter for countries with both sexes and sort by total data points
country_data_counts = country_data_counts[country_data_counts['has_both_sexes'] > 1]
country_data_counts = country_data_counts.sort_values('total_points', ascending=False)

# Get top 4 countries with most data points
top_trend_countries = country_data_counts.head(4)['country'].tolist()

# Filter data for top countries
trend_data = hiv_knowledge_data[hiv_knowledge_data['country'].isin(top_trend_countries)]

# Convert time_period to string and create year_short
trend_data['time_period'] = trend_data['time_period'].astype(str)
trend_data['year_short'] = "'" + trend_data['time_period'].str[2:4]

# Create figure with subplots
fig, axes = plt.subplots(2, 2, figsize=(10, 6), sharex=False, sharey=True)
axes = axes.flatten()

# Use R-like colors to match ggplot2
colors = {'Female': R_COLORS['red'], 'Male': R_COLORS['blue']}

# Plot each country in a subplot
for i, country in enumerate(top_trend_countries):
    country_data = trend_data[trend_data['country'] == country]
    
    # Set background color to light gray
    axes[i].set_facecolor(R_COLORS['background'])
    
    # Plot female and male lines separately
    for sex, group in country_data.groupby('sex'):
        group = group.sort_values('time_period')
        axes[i].plot(group['year_short'], group['obs_value'], 
                    marker='o', markersize=5, 
                    linewidth=1.5, color=colors[sex], 
                    label=sex)
    
    # Set subplot title and grid
    axes[i].set_title(country, fontweight='bold', fontsize=12)
    axes[i].grid(axis='y', linestyle='-', linewidth=0.5, color=R_COLORS['grid'], alpha=0.7)
    axes[i].set_ylim(0, 60)
    axes[i].set_yticks(range(0, 61, 15))
    
    # Only add y-label to the leftmost subplots
    if i % 2 == 0:
        axes[i].set_ylabel('%', fontsize=11)
    
    # Rotate x-axis labels
    axes[i].tick_params(axis='x', rotation=45)
    
    # Set spines
    for spine in ['top', 'right']:
        axes[i].spines[spine].set_visible(False)

# Add a single legend for the entire figure
handles, labels = axes[0].get_legend_handles_labels()
fig.legend(handles, labels, loc='lower center', ncol=2, bbox_to_anchor=(0.5, 0.05), 
          frameon=True, fontsize=10)

# Add overall title
fig.suptitle('HIV Knowledge Trends by Sex & Country', fontsize=14, fontweight='bold', y=0.98)
plt.figtext(0.5, 0.94, 'Percentage of youth (15-24) with comprehensive knowledge', 
           ha='center', va='top', fontsize=11)

# Adjust layout
plt.tight_layout(rect=[0, 0.1, 1, 0.95])
plt.subplots_adjust(wspace=0.1, hspace=0.3)

plt.show()
```

This line chart reveals the evolution of HIV knowledge among young people across countries with the richest trend data, showing patterns of change over time for both males and females.


## [Global Gender Gap in HIV Knowledge]{style="font-family: serif"}

This scatterplot displays HIV knowledge levels for young people (aged 15-24) across all countries, comparing males and females. Each point represents a country-gender combination, with the most recent available data for each country. The visualization reveals a clear pattern of gender disparity in HIV knowledge globally.

```{python global_hiv_knowledge_scatter}
#| code-fold: true
#| code-summary: "Show code for global comparison"
#| fig-align: center
#| fig-width: 10
#| fig-height: 8
#| out-width: 100%

# Get the most recent data for each country and sex combination
hiv_knowledge_global = (
    hiv_knowledge_data
    .sort_values('time_period', ascending=False)
    .groupby(['country', 'sex'])
    .first()
    .reset_index()
)

# Filter to just Male and Female data
hiv_knowledge_global = hiv_knowledge_global[hiv_knowledge_global['sex'].isin(['Female', 'Male'])]

# Create figure for boxplot
fig, ax = plt.subplots(figsize=(10, 8))

# Set background to match ggplot2
ax.set_facecolor(R_COLORS['background'])
fig.patch.set_facecolor('white')

# Create boxplot with ggplot2-like styling
boxprops = dict(linestyle='-', linewidth=1, color='black', facecolor='white', alpha=0.7)
whiskerprops = dict(linestyle='-', linewidth=1, color='black')
medianprops = dict(linestyle='-', linewidth=2, color='black')
capprops = dict(linestyle='-', linewidth=1, color='black')

# Create the boxplot
bplot = ax.boxplot([
    hiv_knowledge_global[hiv_knowledge_global['sex'] == 'Female']['obs_value'],
    hiv_knowledge_global[hiv_knowledge_global['sex'] == 'Male']['obs_value']
], 
    positions=[0, 1], 
    widths=0.5, 
    patch_artist=True,
    boxprops=boxprops,
    whiskerprops=whiskerprops,
    medianprops=medianprops,
    capprops=capprops,
    showfliers=False)

# Color the boxes to match R color scheme
bplot['boxes'][0].set_facecolor(R_COLORS['red'])
bplot['boxes'][1].set_facecolor(R_COLORS['blue'])

# Add individual data points with jitter
for i, sex in enumerate(['Female', 'Male']):
    # Get data for this sex
    data = hiv_knowledge_global[hiv_knowledge_global['sex'] == sex]['obs_value']
    countries = hiv_knowledge_global[hiv_knowledge_global['sex'] == sex]['country']
    
    # Create jittered x positions
    x = np.random.normal(i, 0.08, size=len(data))
    
    # Plot with sex-specific colors matching R
    scatter = ax.scatter(x, data, 
              s=50, 
              alpha=0.7, 
              color=R_COLORS['red'] if sex == 'Female' else R_COLORS['blue'],
              edgecolor='white',
              linewidth=0.5,
              zorder=3)
    
    # Label high and low values
    for j, (value, country) in enumerate(zip(data, countries)):
        if value > 50 or value < 5:  # Label high and low values
            ax.annotate(country, 
                      xy=(x[j], value),
                      xytext=(5, 0), 
                      textcoords='offset points',
                      fontsize=8)

# Draw a horizontal line at the median
plt.axhline(y=hiv_knowledge_global['obs_value'].median(), color='darkgray', 
            linestyle='--', alpha=0.7, zorder=1)

# Set plot labels and title
ax.set_title('Global Gender Gap in HIV Knowledge', fontsize=16, fontweight='bold')
ax.set_ylabel('HIV Knowledge (%)', fontsize=12, fontweight='bold')
ax.set_ylim(0, 70)
ax.set_yticks(range(0, 71, 10))
ax.set_xticks([0, 1])
ax.set_xticklabels(['Female', 'Male'], fontsize=12, fontweight='bold')

# Configure grid to match ggplot2
ax.grid(axis='y', linestyle='-', linewidth=0.5, color=R_COLORS['grid'], alpha=0.7)
ax.grid(axis='x', visible=False)

# Add caption
plt.figtext(0.5, 0.01, 'Most recent data on youth (15-24) with comprehensive HIV knowledge by country', 
           ha='center', va='bottom', fontsize=10)

plt.tight_layout(rect=[0, 0.03, 1, 0.97])
plt.show()
```

These visualizations reveal several important patterns in global HIV knowledge:

1. **Persistent Gender Gap**: The boxplots show that, on average, males tend to have higher levels of HIV knowledge than females across countries. The median knowledge level for males is noticeably higher than for females.

2. **Wide Variation Between Countries**: There is substantial variation in HIV knowledge levels across countries, with some countries showing knowledge rates above 50% while others fall below 5%.

3. **Country-Level Gender Disparities**: The comparison plot clearly shows that in most countries (points falling above the dashed line), males have higher knowledge levels than females. However, there are some exceptions where female knowledge exceeds male knowledge.

4. **Positive Correlation**: There is a strong positive correlation between male and female knowledge levels within countries. Countries that do well in educating one gender about HIV tend to also do well with the other gender.

5. **Regional Patterns**: Some of the highest-performing countries (labeled in the upper right) are clustered in Sub-Saharan Africa, where HIV prevalence is higher and education efforts have been more intensive.

These findings highlight the need for targeted educational interventions that address gender-specific barriers to HIV knowledge, with particular attention to countries and regions where overall knowledge levels remain low.

## [Child Stunting Burden by Country]{style="font-family: serif"}

This map displays the percentage of children under 5 affected by stunting (low height-for-age) in Africa and Asia, the two continents with the highest burden of child malnutrition. By focusing on these regions, we can better visualize where interventions are most urgently needed and identify patterns of child nutrition challenges.

::: {.panel-tabset}

## Africa

```{python stunting_map_africa}
#| code-fold: true
#| code-summary: "Show code"
#| fig-align: center
#| fig-width: 9
#| fig-height: 7
#| out-width: 100%

# Load world map data for Africa
world = gpd.read_file('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson')
africa = world[world['CONTINENT'] == 'Africa'].copy()

# Filter stunting data
stunting_data = combined_indicators[
    (combined_indicators['indicator'].str.contains('height.for.age', case=False, na=False) | 
     combined_indicators['indicator'].str.contains('stunting', case=False, na=False)) &
    (~combined_indicators['obs_value'].isna()) &
    ((combined_indicators['sex'] == 'Total') | combined_indicators['sex'].isna())
]

# Get most recent stunting data for each country
recent_stunting = stunting_data.sort_values('time_period', ascending=False).groupby('country').first().reset_index()

# Create a country name mapping dictionary to match GeoDataFrame names
country_mapping = {
    "Congo, Democratic Republic of the": "Democratic Republic of the Congo",
    "Congo, the Democratic Republic of the": "Democratic Republic of the Congo",
    "Congo": "Republic of the Congo",
    "Tanzania, United Republic of": "United Republic of Tanzania",
    "Swaziland": "eSwatini",
    "Côte d'Ivoire": "Ivory Coast",
    "Ivory Coast": "Ivory Coast"
}

# Apply country name mapping
recent_stunting['map_country'] = recent_stunting['country'].apply(
    lambda x: country_mapping.get(x, x)
)

# Merge stunting data with map data
africa = africa.merge(
    recent_stunting[['map_country', 'obs_value']], 
    left_on='ADMIN', 
    right_on='map_country', 
    how='left'
)

# Create a custom colormap to match R's light yellow to dark green gradient
cmap = LinearSegmentedColormap.from_list(
    'YlGn', ['lightyellow', 'yellowgreen', 'darkgreen']
)

# Create figure
fig, ax = plt.subplots(figsize=(9, 7))
fig.patch.set_facecolor('white')

# Plot base map (all countries light gray)
africa.plot(
    ax=ax,
    color='lightgray',
    edgecolor='#333333',
    linewidth=0.1
)

# Plot data where available with a color gradient
map_with_data = africa[~africa['obs_value'].isna()]
sm = map_with_data.plot(
    ax=ax,
    column='obs_value',
    cmap=cmap,
    edgecolor='#333333',
    linewidth=0.1,
    legend=True,
    legend_kwds={
        'label': 'Stunting Rate (%)',
        'orientation': 'horizontal',
        'shrink': 0.5,
        'pad': 0.01
    }
)

# Remove axis ticks and labels
ax.set_xticks([])
ax.set_yticks([])
ax.set_axis_off()

# Add title and subtitle
plt.suptitle('Child Stunting Burden in Africa', fontsize=16, fontweight='bold', y=0.95)
plt.title('Percentage of children under 5', fontsize=12, pad=10)

plt.tight_layout()
plt.show()
```

## Asia

```{r stunting_map_asia, fig.align='center', fig.width=9, fig.height=7, out.width='100%', warning=FALSE, message=FALSE}
#| code-fold: true
#| code-summary: "Show code"


asia_map <- map_data("world", region = c(
  # Central Asia
  "Kazakhstan", "Kyrgyzstan", "Tajikistan", "Turkmenistan", "Uzbekistan",
  # East Asia
  "China", "Japan", "Mongolia", "North Korea", "South Korea", "Taiwan",
  # South Asia
  "Afghanistan", "Bangladesh", "Bhutan", "India", "Maldives", "Nepal", "Pakistan", "Sri Lanka",
  # Southeast Asia
  "Brunei", "Cambodia", "Indonesia", "Laos", "Malaysia", "Myanmar", "Philippines", 
  "Singapore", "Thailand", "Timor-Leste", "Vietnam",
  # West Asia / Middle East
  "Armenia", "Azerbaijan", "Bahrain", "Cyprus", "Georgia", "Iran", "Iraq", "Israel", 
  "Jordan", "Kuwait", "Lebanon", "Oman", "Palestine", "Qatar", "Saudi Arabia", 
  "Syria", "Turkey", "United Arab Emirates", "Yemen"
))


asia_country_mapping <- c(
  "Iran, Islamic Republic of" = "Iran",
  "Korea, Democratic People's Republic of" = "North Korea",
  "Korea, Republic of" = "South Korea",
  "Lao People's Democratic Republic" = "Laos",
  "Syrian Arab Republic" = "Syria", 
  "Viet Nam" = "Vietnam",
  "Myanmar" = "Burma"
)


country_mapping <- c(country_mapping, asia_country_mapping)


recent_stunting <- stunting_data %>%
  group_by(country) %>%
  arrange(desc(time_period)) %>%
  slice(1) %>%
  ungroup() %>%
  select(country, obs_value) %>%
  mutate(map_region = case_when(
    country %in% names(country_mapping) ~ country_mapping[country],
    TRUE ~ country
  ))


asia_data <- left_join(asia_map, recent_stunting, by = c("region" = "map_region"))


asia_stunting_map <- ggplot() +
  # Base map (all countries gray)
  geom_polygon(data = asia_map, 
               aes(x = long, y = lat, group = group),
               fill = "lightgray", color = "#333333", size = 0.1) +
  
  # Add data where available
  geom_polygon(data = asia_data %>% filter(!is.na(obs_value)),
               aes(x = long, y = lat, group = group, fill = obs_value),
               color = "#333333", size = 0.1) +
  
  # Create color scale from light yellow to dark green
  scale_fill_gradientn(
    colors = c("lightyellow", "yellowgreen", "darkgreen"),
    name = "Stunting Rate (%)",
    guide = guide_colorbar(barwidth = 15, barheight = 0.5, title.position = "top")
  ) +
  
  # Labels and titles
  labs(
    title = "Child Stunting Burden in Asia",
    subtitle = "Percentage of children under 5",
    caption = "Source: UNICEF Data"
  ) +
  
  # Clean theme
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    legend.position = "bottom"
  ) +
  

  coord_fixed(1.3)

print(asia_stunting_map)
```

:::

These maps illustrate the geographic distribution of child stunting across Africa and Asia, revealing distinct regional patterns:

1. **Concentration in Sub-Saharan Africa**: Countries in the Sahel region and Central Africa show some of the highest stunting rates, with over 30% of children affected in many nations.

2. **South Asian hotspot**: Countries like India, Pakistan, Bangladesh, and Nepal form a significant hotspot of child stunting, with India displaying particularly concerning rates.

3. **Variation within regions**: Both continents show significant variation, with some countries making substantial progress while neighboring nations continue to struggle.

The burden of stunting in these two continents is particularly concerning as they collectively account for over 80% of all stunted children worldwide. Targeted interventions in the darkest green areas represent opportunities for significant improvements in global child nutrition outcomes.

## [Progress in Reducing Child Stunting]{style="font-family: serif"}

This area chart tracks Bangladesh's progress in reducing child stunting over time. The visualization demonstrates the country's commitment to improving child nutrition and highlights the effectiveness of targeted interventions implemented over the years. The downward trend represents real improvements in the lives of children and showcases a public health success story that other countries might learn from.

```{r bangladesh_stunting_progress, fig.align='center', fig.width=9, fig.height=6, out.width='90%', warning=FALSE, message=FALSE}

bangladesh_stunting <- combined_indicators %>%
  filter(country == "Bangladesh") %>%
  filter(
    grepl("stunting|height.for.age", indicator, ignore.case = TRUE) &
    !grepl("wasting|weight.for.height", indicator, ignore.case = TRUE)
  ) %>%
  filter(!is.na(obs_value)) %>%
  filter(sex == "Total" | is.na(sex))

bangladesh_stunting <- bangladesh_stunting %>%
  mutate(

    obs_value = ifelse(obs_value > 100, obs_value/100, obs_value),
    obs_value = ifelse(obs_value > 100, 100, obs_value),

    time_period = as.character(time_period)
  ) %>%
  arrange(time_period)


label_data <- bangladesh_stunting
if(nrow(label_data) > 8) {

  n <- ceiling(nrow(label_data) / 8)
  indices_to_keep <- seq(1, nrow(label_data), by = n)
  label_data <- label_data[indices_to_keep, ]
}


stunting_area_chart <- ggplot(bangladesh_stunting, aes(x = time_period, y = obs_value, group = 1)) +

  geom_area(fill = "darkgreen", alpha = 0.7) +

  geom_line(color = "darkgreen", size = 1.2) +

  geom_point(color = "darkgreen", size = 3) +

  geom_text(
    data = label_data,
    aes(label = sprintf("%.1f%%", obs_value)), 
    vjust = -1, size = 4, color = "darkgreen"
  ) +

  labs(
    title = "Progress in Reducing Child Stunting in Bangladesh",
    subtitle = "Percentage of children under 5",
    x = "Year",
    y = "Stunting Rate (%)",
    caption = "Source: UNICEF Child Indicator Data"
  ) +

  scale_x_discrete() +
 
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
 
  scale_y_continuous(
    limits = c(0, 100),
    breaks = seq(0, 100, by = 10),
    labels = function(x) paste0(x, "%")
  )


print(stunting_area_chart)
```

This area chart illustrates Bangladesh's remarkable journey in reducing the prevalence of child stunting over time. The dark green area represents the percentage of children under 5 who are stunted (height-for-age below -2 standard deviations from the median).

The downward slope of the chart tells a positive story of nutrition improvement in Bangladesh, which has been achieved through a combination of:

1. **Targeted nutrition interventions** - Including micronutrient supplementation, promotion of exclusive breastfeeding, and complementary feeding practices

2. **Broader development progress** - Economic growth, improved food security, and enhanced maternal education

3. **Health system strengthening** - Better access to healthcare services, improved water and sanitation facilities, and increased immunization coverage

Bangladesh's progress serves as an inspiring example for other countries facing similar challenges. The consistent decline demonstrates that with sustained commitment and evidence-based approaches, significant improvements in child nutrition outcomes are achievable even in resource-constrained settings.

## [Conclusion]{style="font-family: serif"}

The analysis **reveals persistent and significant challenges** in both child stunting and HIV awareness among youth worldwide. **Stunting remains highly concentrated in South Asia and Sub-Saharan Africa**, with countries such as India, Bangladesh, and several Central African nations bearing the greatest burden. 

Despite some notable progress, represents by Bangladesh's steady reduction in stunting rates, **millions of children continue to face the lifelong consequences of undernutrition**. At the same time, global HIV knowledge among youth displays stark disparities, with leading countries in Eastern and Southern Africa achieving much higher awareness rates than those at the bottom of the scale.

Gender gaps further compound these issues, as **males generally possess higher HIV knowledge than females** in most countries.

These findings emphasised the urgent need for targeted, region-specific interventions that address both the immediate and systemic factors driving these public health challenges.

## [Solutions]{style="font-family: serif"}

1. Prioritize **targeted investments** in countries and regions with the highest rates of child stunting and lowest HIV knowledge, particularly in South Asia and Sub-Saharan Africa.
2. Develop and **implement gender-sensitive education campaigns** to close the HIV knowledge gap between males and females, ensuring equitable access to information for all youth.
3. **Integrate nutrition initiatives** with broader development strategies, including improving maternal education, healthcare access, water and sanitation, and food security.
4.Establish **robust data monitoring systems to track progress**, identify emerging gaps, and enable adaptive, evidence-based policymaking.
5. Foster **multisectoral collaboration** among governments, NGOs, and international organizations to address both immediate needs and the underlying social determinants of health.
6. Promote the **exchange of best practices** by learning from successful countries, adapting proven interventions to local contexts, and scaling up effective solutions.

By acting on these recommendations, we can accelerate progress and help more children grow up healthy and strong.

------------------------------------------------------------------------

```{r}
country_comparison <- hiv_knowledge_global %>%
  select(country, sex, obs_value) %>%
  tidyr::pivot_wider(
    names_from = sex,
    values_from = obs_value
  ) %>%
  filter(!is.na(Female) & !is.na(Male))

comparison_plot <- ggplot(country_comparison, aes(x = Female, y = Male)) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "gray") +
  geom_point(size = 3, alpha = 0.7, color = "#3498db") +
  geom_smooth(method = "lm", se = TRUE, color = "#e74c3c", fill = "#f8d5ce") +
  geom_text_repel(
    data = country_comparison %>% 
             filter(abs(Male - Female) > 10 | Female > 45 | Male > 45),
    aes(label = country),
    size = 3,
    box.padding = 0.5,
    point.padding = 0.3,
    max.overlaps = 10,
    show.legend = FALSE
  ) +
  labs(
    title = "HIV Knowledge: Male vs. Female Comparison",
    subtitle = "Each point represents a country's most recent data",
    x = "Female Knowledge (%)",
    y = "Male Knowledge (%)",
    caption = "Points above dashed line: Male knowledge exceeds female knowledge"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    panel.grid.minor = element_blank(),
    axis.title = element_text(face = "bold", size = 12)
  ) +
  scale_x_continuous(limits = c(0, 70), breaks = seq(0, 70, by = 10)) +
  scale_y_continuous(limits = c(0, 70), breaks = seq(0, 70, by = 10)) +
  coord_fixed()

print(comparison_plot)
```

------------------------------------------------------------------------

```{python}
#| code-fold: true
#| code-summary: "Show code for male vs female comparison"
#| fig-align: center
#| fig-width: 10
#| fig-height: 8
#| out-width: 100%

# Create country comparison plot
country_comparison = (
    hiv_knowledge_global
    .pivot(index='country', columns='sex', values='obs_value')
    .reset_index()
    .dropna()
)

# Create figure
fig, ax = plt.subplots(figsize=(10, 8))

# Set background
ax.set_facecolor('white')

# Add the identity line (y = x)
ax.plot([0, 70], [0, 70], 'k--', alpha=0.5, linewidth=1, zorder=1)

# Add the data points
ax.scatter(country_comparison['Female'], 
          country_comparison['Male'], 
          s=60, 
          alpha=0.7, 
          color='#3498db',
          zorder=3)

# Add a trend line
x = country_comparison['Female'].values
y = country_comparison['Male'].values
z = np.polyfit(x, y, 1)
p = np.poly1d(z)
ax.plot(x, p(x), color='#e74c3c', alpha=0.8, linewidth=2, zorder=2)

# Add confidence interval around trend line (similar to geom_smooth in R)
# Calculate residuals and standard deviation
residuals = y - p(x)
std_dev = np.std(residuals)

# Create confidence intervals (approximately 95%)
x_smooth = np.linspace(min(x), max(x), 100)
y_smooth = p(x_smooth)
y_upper = y_smooth + 1.96 * std_dev
y_lower = y_smooth - 1.96 * std_dev

# Plot confidence interval
ax.fill_between(x_smooth, y_lower, y_upper, color='#f8d5ce', alpha=0.5, zorder=1)

# Highlight countries with large disparities or high values
for _, row in country_comparison.iterrows():
    if abs(row['Male'] - row['Female']) > 10 or row['Female'] > 45 or row['Male'] > 45:
        ax.annotate(row['country'], 
                   xy=(row['Female'], row['Male']),
                   xytext=(5, 0), 
                   textcoords='offset points',
                   fontsize=8)

# Set plot attributes
ax.set_title('HIV Knowledge: Male vs. Female Comparison', fontsize=16, fontweight='bold')
ax.set_xlabel('Female Knowledge (%)', fontsize=12, fontweight='bold')
ax.set_ylabel('Male Knowledge (%)', fontsize=12, fontweight='bold')
ax.set_xlim(0, 70)
ax.set_ylim(0, 70)
ax.set_xticks(range(0, 71, 10))
ax.set_yticks(range(0, 71, 10))

# Configure grid
ax.grid(axis='both', linestyle='-', linewidth=0.5, color='#CCCCCC', alpha=0.7)

# Add caption
plt.figtext(0.5, 0.01, 'Points above dashed line: Male knowledge exceeds female knowledge', 
           ha='center', va='bottom', fontsize=10)

plt.tight_layout(rect=[0, 0.03, 1, 0.97])
plt.show()
```

------------------------------------------------------------------------
